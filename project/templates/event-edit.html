{% extends "base.html" %}
{% block title %}Edit Event â€” Event Calendar{% endblock %}
{% block content %}
<div class="event-form-container">
  <div class="event-form-card">
    <h1>Edit Event</h1>

    <form id="event-form" class="event-form" enctype="multipart/form-data">
      <!-- Hidden Event ID -->
      <input type="hidden" id="event-id" name="event_id">

      <!-- Event Title -->
      <div class="form-group">
        <label for="title">Event Title <span class="required">*</span></label>
        <input id="title" name="title" type="text" required maxlength="255" placeholder="Enter event title">
        <span class="error-message" id="title-error"></span>
      </div>

      <!-- Event Description -->
      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" name="description" rows="5" placeholder="Describe your event..."
          maxlength="2000"></textarea>
        <small class="form-hint"><span id="desc-count">0</span>/2000 characters</small>
        <span class="error-message" id="description-error"></span>
      </div>

      <!-- Start Date & Time -->
      <div class="form-row">
        <div class="form-group">
          <label for="start-date">Start Date <span class="required">*</span></label>
          <input id="start-date" name="start_date" type="date" required>
          <span class="error-message" id="start-date-error"></span>
        </div>

        <div class="form-group">
          <label for="start-time">Start Time <span class="required">*</span></label>
          <input id="start-time" name="start_time" type="time" required>
          <span class="error-message" id="start-time-error"></span>
        </div>
      </div>

      <!-- End Date & Time -->
      <div class="form-row">
        <div class="form-group">
          <label for="end-date">End Date <span class="required">*</span></label>
          <input id="end-date" name="end_date" type="date" required>
          <span class="error-message" id="end-date-error"></span>
        </div>

        <div class="form-group">
          <label for="end-time">End Time <span class="required">*</span></label>
          <input id="end-time" name="end_time" type="time" required>
          <span class="error-message" id="end-time-error"></span>
        </div>
      </div>

      <!-- Location -->
      <div class="form-group">
        <label for="location">Location</label>
        <input id="location" name="location" type="text" maxlength="255" placeholder="e.g., Main Hall, Building A">
        <span class="error-message" id="location-error"></span>
      </div>

      <!-- Venue Details -->
      <div class="form-group">
        <label for="venue-name">Venue Name <span class="required">*</span></label>
        <input id="venue-name" name="venue_name" type="text" required maxlength="255" placeholder="Enter venue name">
        <span class="error-message" id="venue-name-error"></span>
      </div>

      <div class="form-group">
        <label for="venue-address">Venue Address <span class="required">*</span></label>
        <input id="venue-address" name="venue_address" type="text" required maxlength="255"
          placeholder="Enter venue address">
        <span class="error-message" id="venue-address-error"></span>
      </div>

      <div class="form-group">
        <label for="venue-postal">Postal Code <span class="required">*</span></label>
        <input id="venue-postal" name="venue_postal" type="text" required pattern="\d{6}" maxlength="6"
          placeholder="6-digit postal code">
        <small class="form-hint">6 digits (e.g., 123456)</small>
        <span class="error-message" id="venue-postal-error"></span>
      </div>

      <!-- Event Tags/Categories -->
      <div class="form-group">
        <label for="event-tags">Event Categories <span class="required">*</span></label>
        <div id="event-tags-container" class="tags-grid">
          <div class="loading">Loading categories...</div>
        </div>
        <small class="form-hint">Select at least one category that best describes your event</small>
        <span class="error-message" id="tags-error"></span>

        <!-- Create New Category -->
        <div class="create-tag-section" style="margin-top: 12px;">
          <div class="create-tag-input-group">
            <input type="text" id="new-tag-input" placeholder="Create new category..." maxlength="45"
              style="flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px;">
            <button type="button" id="create-tag-btn" class="btn-secondary" style="margin-left: 8px;">+ Add</button>
          </div>
          <span class="error-message" id="new-tag-error"></span>
        </div>
      </div>

      <!-- Event Image -->
      <div class="form-group">
        <label for="image-upload">Event Image</label>
        <div class="image-upload-container">
          <div class="image-preview">
            <img id="image-preview-img" src="/static/assets/images/default-event.svg" alt="Event preview">
          </div>
          <div class="image-upload-controls">
            <input type="file" id="image-upload" name="image" accept="image/jpeg,image/png,image/webp"
              style="display: none;">
            <button type="button" id="choose-image-btn" class="btn btn-secondary">Choose Image</button>
            <button type="button" id="remove-image-btn" class="btn btn-secondary">Remove Image</button>
          </div>
        </div>
        <small class="form-hint">Optional: Max 5MB (JPEG, PNG, WebP)</small>
        <span class="error-message" id="image-error"></span>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">Update Event</button>
        <button type="button" id="delete-btn" class="btn btn-danger">Delete Event</button>
        <a href="/manage-events" class="btn btn-secondary">Cancel</a>
      </div>

      <!-- Feedback Message -->
      <p id="form-feedback" role="status" aria-live="polite"></p>
    </form>
  </div>
</div>
{% endblock %}
{% block scripts %}
<script type="module" src="{{ url_for('static', filename='js/event-form.js') }}" defer></script>
{% endblock %}